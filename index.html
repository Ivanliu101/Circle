<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CircleOS v0.0.1</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#6B7280',
                        dark: '#1F2937',
                        light: '#F9FAFB',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .window-shadow {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
            .task-item {
                transition: all 0.2s ease;
            }
            .task-item:hover {
                background-color: rgba(59, 130, 246, 0.1);
            }
            .fade-in {
                animation: fadeIn 0.3s ease-in-out;
            }
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            .slide-up {
                animation: slideUp 0.3s ease-in-out;
            }
            @keyframes slideUp {
                from { transform: translateY(20px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
        }
    </style>
    <style>
        body {
            transition: background-color 0.5s ease;
        }
        .window {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
        }
        .window.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }
        .window-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 16px;
            background-color: #f1f5f9;
            border-bottom: 1px solid #e2e8f0;
        }
        .window-content {
            padding: 16px;
            overflow-y: auto;
            max-height: calc(80vh - 48px);
        }
        .close-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #64748b;
        }
        .close-btn:hover {
            color: #ef4444;
        }
        .app-icon {
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .app-icon:hover {
            transform: scale(1.05);
        }
        .app-icon.active {
            border-bottom: 2px solid #3b82f6;
        }
        .pin-input {
            width: 40px;
            height: 40px;
            font-size: 20px;
            text-align: center;
            margin: 0 5px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
        }
        .pin-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }
        .setup-step {
            display: none;
        }
        .setup-step.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }
        .wallpaper-option {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease;
            border: 2px solid transparent;
        }
        .wallpaper-option:hover {
            transform: scale(1.05);
        }
        .wallpaper-option.selected {
            border-color: #3b82f6;
        }
        .task-form input, .task-form textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
        }
        .task-form input:focus, .task-form textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }
        .task-list {
            list-style: none;
            padding: 0;
        }
        .task-item {
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .task-item.completed {
            text-decoration: line-through;
            color: #9ca3af;
        }
        .task-actions {
            display: flex;
            gap: 5px;
        }
        .task-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        .edit-btn {
            color: #3b82f6;
        }
        .delete-btn {
            color: #ef4444;
        }
        .complete-btn {
            color: #10b981;
        }
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            max-height: 300px;
            overflow-y: auto;
            z-index: 5;
            display: none;
        }
        .search-results.active {
            display: block;
        }
        .search-item {
            padding: 8px 16px;
            cursor: pointer;
        }
        .search-item:hover {
            background-color: #f1f5f9;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
<!-- 启动设置界面 -->
<div id="setup-screen" class="fixed inset-0 bg-white z-50 flex items-center justify-center p-4">
    <div class="w-full max-w-md bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold text-center mb-6">欢迎使用 CircleOS v0.0.1</h1>
        <div class="setup-progress mb-6">
            <div class="flex justify-between mb-2">
                <span id="setup-step-indicator" class="text-sm font-medium text-gray-600">步骤 1/3</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2.5">
                <div id="setup-progress-bar" class="bg-primary h-2.5 rounded-full" style="width: 33%"></div>
            </div>
        </div>

        <!-- 设置步骤 1: PIN码 -->
        <div id="setup-step-1" class="setup-step active">
            <h2 class="text-lg font-semibold mb-4">设置PIN码</h2>
            <p class="text-gray-600 mb-4">请设置一个4位数字的PIN码，用于锁定和解锁系统。</p>
            <div class="flex justify-center mb-4">
                <input type="password" maxlength="1" class="pin-input" id="pin-1" autofocus>
                <input type="password" maxlength="1" class="pin-input" id="pin-2">
                <input type="password" maxlength="1" class="pin-input" id="pin-3">
                <input type="password" maxlength="1" class="pin-input" id="pin-4">
            </div>
            <div class="text-center">
                <button id="next-step-1" class="bg-primary text-white px-6 py-2 rounded-md hover:bg-blue-600 transition">下一步</button>
            </div>
        </div>

        <!-- 设置步骤 2: 壁纸 -->
        <div id="setup-step-2" class="setup-step">
            <h2 class="text-lg font-semibold mb-4">选择壁纸颜色</h2>
            <p class="text-gray-600 mb-4">请选择您喜欢的桌面壁纸颜色。</p>
            <div class="flex justify-center gap-4 mb-4">
                <div class="wallpaper-option selected" data-color="bg-black" style="background-color: black;"></div>
                <div class="wallpaper-option" data-color="bg-blue-500" style="background-color: #3b82f6;"></div>
                <div class="wallpaper-option" data-color="bg-red-500" style="background-color: #ef4444;"></div>
                <div class="wallpaper-option" data-color="bg-white" style="background-color: white; border: 1px solid #e2e8f0;"></div>
            </div>
            <div class="text-center">
                <button id="prev-step-2" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-400 transition mr-2">上一步</button>
                <button id="next-step-2" class="bg-primary text-white px-6 py-2 rounded-md hover:bg-blue-600 transition">下一步</button>
            </div>
        </div>

        <!-- 设置步骤 3: 使用说明 -->
        <div id="setup-step-3" class="setup-step">
            <h2 class="text-lg font-semibold mb-4">使用说明</h2>
            <div class="bg-gray-50 p-4 rounded-md mb-4">
                <h3 class="font-medium mb-2">基本操作</h3>
                <ul class="list-disc pl-5 space-y-1 text-sm">
                    <li>点击底部工具栏的图标打开应用程序</li>
                    <li>点击顶部工具栏的锁图标锁定系统</li>
                    <li>点击顶部工具栏的搜索框进行搜索</li>
                    <li>点击设置应用程序更改系统设置</li>
                </ul>
            </div>
            <div class="bg-gray-50 p-4 rounded-md mb-4">
                <h3 class="font-medium mb-2">应用程序</h3>
                <ul class="list-disc pl-5 space-y-1 text-sm">
                    <li><strong>VS Code</strong>：简单的代码编辑器</li>
                    <li><strong>记事本</strong>：记录文本笔记</li>
                    <li><strong>系统设置</strong>：更改系统配置</li>
                    <li><strong>计算器</strong>：任务日历，管理您的任务</li>
                </ul>
            </div>
            <div class="text-center">
                <button id="prev-step-3" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-400 transition mr-2">上一步</button>
                <button id="finish-setup" class="bg-primary text-white px-6 py-2 rounded-md hover:bg-blue-600 transition">完成设置</button>
            </div>
        </div>
    </div>
</div>

<!-- 锁定界面 -->
<div id="lock-screen" class="fixed inset-0 bg-black z-40 flex items-center justify-center hidden">
    <div class="w-full max-w-sm bg-gray-900 rounded-lg shadow-lg p-6 text-white">
        <h1 class="text-2xl font-bold text-center mb-8">CircleOS v0.0.1</h1>
        <h2 class="text-lg text-center mb-6">请输入PIN码解锁</h2>
        <div class="flex justify-center mb-6">
            <input type="password" maxlength="1" class="pin-input bg-gray-800 text-white border-gray-700" id="lock-pin-1" autofocus>
            <input type="password" maxlength="1" class="pin-input bg-gray-800 text-white border-gray-700" id="lock-pin-2">
            <input type="password" maxlength="1" class="pin-input bg-gray-800 text-white border-gray-700" id="lock-pin-3">
            <input type="password" maxlength="1" class="pin-input bg-gray-800 text-white border-gray-700" id="lock-pin-4">
        </div>
        <p id="lock-error" class="text-red-500 text-center hidden">PIN码错误，请重试</p>
    </div>
</div>

<!-- 主桌面界面 -->
<div id="desktop" class="min-h-screen flex flex-col">
    <!-- 顶部工具栏 -->
    <div class="bg-white border-b border-gray-200 py-2 px-4 flex justify-between items-center">
        <div class="flex items-center">
            <button id="lock-btn" class="text-gray-600 hover:text-gray-900 mr-4">
                <i class="fa fa-lock" aria-hidden="true"></i>
            </button>
        </div>
        <div class="relative w-1/3">
            <input type="text" id="search-input" placeholder="搜索..." class="w-full py-1 px-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
            <div id="search-results" class="search-results">
                <!-- 搜索结果将在这里显示 -->
            </div>
        </div>
        <div class="text-gray-600">
            <span id="current-time"></span>
        </div>
    </div>

    <!-- 桌面内容区域 -->
    <div id="desktop-content" class="flex-grow p-4">
        <!-- 应用程序窗口将在这里动态显示 -->
    </div>

    <!-- 底部工具栏 -->
    <div class="bg-white border-t border-gray-200 py-2 px-4 flex justify-center">
        <div class="flex space-x-8">
            <div class="app-icon flex flex-col items-center" data-app="vscode">
                <i class="fa fa-code text-2xl text-blue-600" aria-hidden="true"></i>
                <span class="text-xs mt-1">VS Code</span>
            </div>
            <div class="app-icon flex flex-col items-center" data-app="notepad">
                <i class="fa fa-file-text-o text-2xl text-green-600" aria-hidden="true"></i>
                <span class="text-xs mt-1">记事本</span>
            </div>
            <div class="app-icon flex flex-col items-center" data-app="settings">
                <i class="fa fa-cog text-2xl text-gray-600" aria-hidden="true"></i>
                <span class="text-xs mt-1">设置</span>
            </div>
            <div class="app-icon flex flex-col items-center" data-app="calculator">
                <i class="fa fa-calendar text-2xl text-purple-600" aria-hidden="true"></i>
                <span class="text-xs mt-1">计算器</span>
            </div>
        </div>
    </div>

    <!-- 系统版本信息 -->
    <div class="text-center text-gray-400 text-xs py-1">
        CircleOS v0.0.1
    </div>
</div>

<!-- VS Code 应用窗口 -->
<div id="vscode-window" class="window">
    <div class="window-header">
        <h3>VS Code</h3>
        <button class="close-btn" data-app="vscode">×</button>
    </div>
    <div class="window-content">
        <div class="bg-gray-900 text-white p-4 rounded-md mb-4">
            <div class="text-sm text-green-400 mb-2">// 这是一个简单的代码编辑器</div>
            <div class="text-sm text-blue-400">function <span class="text-yellow-300">greet</span>() {</div>
            <div class="text-sm text-blue-400 ml-4">console.log(<span class="text-green-300">"Hello, CircleOS!"</span>);</div>
            <div class="text-sm text-blue-400">}</div>
            <div class="text-sm text-blue-400 mt-2"><span class="text-yellow-300">greet</span>();</div>
        </div>
        <textarea id="code-editor" class="w-full h-64 p-4 bg-gray-100 border border-gray-300 rounded-md font-mono text-sm" placeholder="在这里编写您的代码..."></textarea>
        <div class="mt-4 flex justify-end">
            <button id="save-code" class="bg-primary text-white px-4 py-2 rounded-md hover:bg-blue-600 transition">保存代码</button>
        </div>
    </div>
</div>

<!-- 记事本应用窗口 -->
<div id="notepad-window" class="window">
    <div class="window-header">
        <h3>记事本</h3>
        <button class="close-btn" data-app="notepad">×</button>
    </div>
    <div class="window-content">
        <textarea id="notepad-content" class="w-full h-64 p-4 bg-gray-50 border border-gray-300 rounded-md" placeholder="在这里记录您的笔记..."></textarea>
        <div class="mt-4 flex justify-end">
            <button id="save-note" class="bg-primary text-white px-4 py-2 rounded-md hover:bg-blue-600 transition">保存笔记</button>
        </div>
    </div>
</div>

<!-- 设置应用窗口 -->
<div id="settings-window" class="window">
    <div class="window-header">
        <h3>系统设置</h3>
        <button class="close-btn" data-app="settings">×</button>
    </div>
    <div class="window-content">
        <div class="mb-6">
            <h4 class="text-lg font-medium mb-2">壁纸颜色</h4>
            <div class="flex gap-4">
                <div class="wallpaper-option" data-color="bg-black" style="background-color: black;"></div>
                <div class="wallpaper-option" data-color="bg-blue-500" style="background-color: #3b82f6;"></div>
                <div class="wallpaper-option" data-color="bg-red-500" style="background-color: #ef4444;"></div>
                <div class="wallpaper-option" data-color="bg-white" style="background-color: white; border: 1px solid #e2e8f0;"></div>
            </div>
        </div>
        <div class="mb-6">
            <h4 class="text-lg font-medium mb-2">修改PIN码</h4>
            <div class="flex justify-center mb-4">
                <input type="password" maxlength="1" class="pin-input" id="new-pin-1">
                <input type="password" maxlength="1" class="pin-input" id="new-pin-2">
                <input type="password" maxlength="1" class="pin-input" id="new-pin-3">
                <input type="password" maxlength="1" class="pin-input" id="new-pin-4">
            </div>
            <div class="text-center">
                <button id="save-pin" class="bg-primary text-white px-4 py-2 rounded-md hover:bg-blue-600 transition">保存PIN码</button>
            </div>
        </div>
        <div class="mb-6">
            <h4 class="text-lg font-medium mb-2">数据备份</h4>
            <div class="flex justify-center gap-4">
                <button id="export-data" class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition">导出数据</button>
                <button id="import-data" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition">导入数据</button>
                <input type="file" id="import-file" accept=".json" class="hidden">
            </div>
        </div>
    </div>
</div>

<!-- 计算器（任务日历）应用窗口 -->
<div id="calculator-window" class="window">
    <div class="window-header">
        <h3>任务日历</h3>
        <button class="close-btn" data-app="calculator">×</button>
    </div>
    <div class="window-content">
        <div class="mb-6">
            <h4 class="text-lg font-medium mb-2">添加新任务</h4>
            <form id="task-form" class="task-form">
                <input type="text" id="task-title" placeholder="任务标题" required>
                <textarea id="task-description" placeholder="任务描述" rows="2"></textarea>
                <input type="date" id="task-date" required>
                <div class="flex justify-end">
                    <button type="submit" class="bg-primary text-white px-4 py-2 rounded-md hover:bg-blue-600 transition">添加任务</button>
                </div>
            </form>
        </div>
        <div>
            <h4 class="text-lg font-medium mb-2">任务列表</h4>
            <ul id="task-list" class="task-list">
                <!-- 任务列表将在这里动态显示 -->
            </ul>
        </div>
    </div>
</div>

<script>
    // 系统初始化
    document.addEventListener('DOMContentLoaded', function() {
        // 检查是否首次启动
        const isFirstTime = !localStorage.getItem('circleos_config');

        if (isFirstTime) {
            // 显示设置向导
            document.getElementById('setup-screen').classList.remove('hidden');
            setupPinInputs();
            setupWallpaperOptions();
            setupSetupNavigation();
        } else {
            // 加载系统配置
            loadSystemConfig();
            // 显示桌面
            document.getElementById('desktop').classList.remove('hidden');
            // 更新时间
            updateTime();
            setInterval(updateTime, 60000);
        }

        // 设置应用程序点击事件
        setupAppIcons();

        // 设置锁定按钮
        document.getElementById('lock-btn').addEventListener('click', lockSystem);

        // 设置锁定界面PIN输入
        setupLockPinInputs();

        // 设置搜索功能
        setupSearch();

        // 加载应用程序数据
        loadAppData();
    });

    // PIN码输入设置
    function setupPinInputs() {
        const pinInputs = document.querySelectorAll('#setup-step-1 .pin-input');

        pinInputs.forEach((input, index) => {
            input.addEventListener('input', function() {
                if (this.value.length === 1) {
                    if (index < pinInputs.length - 1) {
                        pinInputs[index + 1].focus();
                    }
                }
            });

            input.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && this.value.length === 0 && index > 0) {
                    pinInputs[index - 1].focus();
                }
            });
        });
    }

    // 锁定界面PIN输入设置
    function setupLockPinInputs() {
        const lockPinInputs = document.querySelectorAll('#lock-screen .pin-input');

        lockPinInputs.forEach((input, index) => {
            input.addEventListener('input', function() {
                if (this.value.length === 1) {
                    if (index < lockPinInputs.length - 1) {
                        lockPinInputs[index + 1].focus();
                    } else {
                        // 检查PIN码
                        checkPin();
                    }
                }
            });

            input.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && this.value.length === 0 && index > 0) {
                    lockPinInputs[index - 1].focus();
                }
            });
        });
    }

    // 壁纸选项设置
    function setupWallpaperOptions() {
        const wallpaperOptions = document.querySelectorAll('.wallpaper-option');

        wallpaperOptions.forEach(option => {
            option.addEventListener('click', function() {
                // 移除所有选中状态
                wallpaperOptions.forEach(opt => opt.classList.remove('selected'));
                // 添加当前选中状态
                this.classList.add('selected');
            });
        });
    }

    // 设置向导导航
    function setupSetupNavigation() {
        // 步骤 1 -> 步骤 2
        document.getElementById('next-step-1').addEventListener('click', function() {
            const pinInputs = document.querySelectorAll('#setup-step-1 .pin-input');
            let pin = '';
            let isValid = true;

            pinInputs.forEach(input => {
                if (!input.value) {
                    isValid = false;
                }
                pin += input.value;
            });

            if (isValid && pin.length === 4) {
                // 保存PIN码（简单加密）
                localStorage.setItem('circleos_pin', btoa(pin));

                // 更新进度条
                document.getElementById('setup-progress-bar').style.width = '66%';
                document.getElementById('setup-step-indicator').textContent = '步骤 2/3';

                // 显示步骤 2
                document.getElementById('setup-step-1').classList.remove('active');
                document.getElementById('setup-step-2').classList.add('active');
            } else {
                alert('请输入完整的4位PIN码');
            }
        });

        // 步骤 2 -> 步骤 1
        document.getElementById('prev-step-2').addEventListener('click', function() {
            // 更新进度条
            document.getElementById('setup-progress-bar').style.width = '33%';
            document.getElementById('setup-step-indicator').textContent = '步骤 1/3';

            // 显示步骤 1
            document.getElementById('setup-step-2').classList.remove('active');
            document.getElementById('setup-step-1').classList.add('active');
        });

        // 步骤 2 -> 步骤 3
        document.getElementById('next-step-2').addEventListener('click', function() {
            // 获取选中的壁纸颜色
            const selectedWallpaper = document.querySelector('#setup-step-2 .wallpaper-option.selected');
            const wallpaperColor = selectedWallpaper.getAttribute('data-color');

            // 保存壁纸颜色
            localStorage.setItem('circleos_wallpaper', wallpaperColor);

            // 更新进度条
            document.getElementById('setup-progress-bar').style.width = '100%';
            document.getElementById('setup-step-indicator').textContent = '步骤 3/3';

            // 显示步骤 3
            document.getElementById('setup-step-2').classList.remove('active');
            document.getElementById('setup-step-3').classList.add('active');
        });

        // 步骤 3 -> 步骤 2
        document.getElementById('prev-step-3').addEventListener('click', function() {
            // 更新进度条
            document.getElementById('setup-progress-bar').style.width = '66%';
            document.getElementById('setup-step-indicator').textContent = '步骤 2/3';

            // 显示步骤 2
            document.getElementById('setup-step-3').classList.remove('active');
            document.getElementById('setup-step-2').classList.add('active');
        });

        // 完成设置
        document.getElementById('finish-setup').addEventListener('click', function() {
            // 创建系统配置标记
            localStorage.setItem('circleos_config', 'true');

            // 隐藏设置向导
            document.getElementById('setup-screen').classList.add('hidden');

            // 显示桌面
            document.getElementById('desktop').classList.remove('hidden');

            // 应用壁纸颜色
            applyWallpaper();

            // 更新时间
            updateTime();
            setInterval(updateTime, 60000);
        });
    }

    // 应用程序图标设置
    function setupAppIcons() {
        const appIcons = document.querySelectorAll('.app-icon');

        appIcons.forEach(icon => {
            icon.addEventListener('click', function() {
                const appName = this.getAttribute('data-app');
                openApp(appName);
            });
        });

        // 设置关闭按钮
        const closeButtons = document.querySelectorAll('.close-btn');
        closeButtons.forEach(button => {
            button.addEventListener('click', function() {
                const appName = this.getAttribute('data-app');
                closeApp(appName);
            });
        });
    }

    // 打开应用程序
    function openApp(appName) {
        // 关闭所有应用
        document.querySelectorAll('.window').forEach(window => {
            window.classList.remove('active');
        });

        // 打开指定应用
        const appWindow = document.getElementById(`${appName}-window`);
        if (appWindow) {
            appWindow.classList.add('active');

            // 如果是计算器应用，加载任务
            if (appName === 'calculator') {
                loadTasks();
            }

            // 如果是VS Code或记事本，加载保存的内容
            if (appName === 'vscode' || appName === 'notepad') {
                loadAppContent(appName);
            }
        }
    }

    // 关闭应用程序
    function closeApp(appName) {
        const appWindow = document.getElementById(`${appName}-window`);
        if (appWindow) {
            appWindow.classList.remove('active');
        }
    }

    // 锁定系统
    function lockSystem() {
        document.getElementById('lock-screen').classList.remove('hidden');

        // 清空PIN输入
        document.querySelectorAll('#lock-screen .pin-input').forEach(input => {
            input.value = '';
        });

        // 聚焦第一个输入框
        document.getElementById('lock-pin-1').focus();

        // 隐藏错误信息
        document.getElementById('lock-error').classList.add('hidden');
    }

    // 检查PIN码
    function checkPin() {
        const lockPinInputs = document.querySelectorAll('#lock-screen .pin-input');
        let enteredPin = '';

        lockPinInputs.forEach(input => {
            enteredPin += input.value;
        });

        const storedPin = atob(localStorage.getItem('circleos_pin'));

        if (enteredPin === storedPin) {
            // 解锁系统
            document.getElementById('lock-screen').classList.add('hidden');
        } else {
            // 显示错误信息
            document.getElementById('lock-error').classList.remove('hidden');

            // 清空PIN输入
            setTimeout(() => {
                lockPinInputs.forEach(input => {
                    input.value = '';
                });
                document.getElementById('lock-pin-1').focus();
                document.getElementById('lock-error').classList.add('hidden');
            }, 1500);
        }
    }

    // 更新时间
    function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString();
        document.getElementById('current-time').textContent = timeString;
    }

    // 应用壁纸
    function applyWallpaper() {
        const wallpaperColor = localStorage.getItem('circleos_wallpaper') || 'bg-black';
        document.getElementById('desktop-content').className = `flex-grow p-4 ${wallpaperColor} transition-colors duration-500`;
    }

    // 加载系统配置
    function loadSystemConfig() {
        // 应用壁纸
        applyWallpaper();

        // 设置设置页面的壁纸选项
        const wallpaperColor = localStorage.getItem('circleos_wallpaper') || 'bg-black';
        document.querySelectorAll('#settings-window .wallpaper-option').forEach(option => {
            option.classList.remove('selected');
            if (option.getAttribute('data-color') === wallpaperColor) {
                option.classList.add('selected');
            }
        });

        // 设置设置页面的壁纸选项点击事件
        document.querySelectorAll('#settings-window .wallpaper-option').forEach(option => {
            option.addEventListener('click', function() {
                // 移除所有选中状态
                document.querySelectorAll('#settings-window .wallpaper-option').forEach(opt => opt.classList.remove('selected'));
                // 添加当前选中状态
                this.classList.add('selected');

                // 保存壁纸颜色
                const newWallpaperColor = this.getAttribute('data-color');
                localStorage.setItem('circleos_wallpaper', newWallpaperColor);

                // 应用新壁纸
                applyWallpaper();
            });
        });

        // 设置保存PIN码按钮
        document.getElementById('save-pin').addEventListener('click', function() {
            const newPinInputs = document.querySelectorAll('#settings-window .pin-input');
            let newPin = '';
            let isValid = true;

            newPinInputs.forEach(input => {
                if (!input.value) {
                    isValid = false;
                }
                newPin += input.value;
            });

            if (isValid && newPin.length === 4) {
                // 保存新PIN码（简单加密）
                localStorage.setItem('circleos_pin', btoa(newPin));

                // 清空输入
                newPinInputs.forEach(input => {
                    input.value = '';
                });

                alert('PIN码已更新');
            } else {
                alert('请输入完整的4位PIN码');
            }
        });

        // 设置导出数据按钮
        document.getElementById('export-data').addEventListener('click', function() {
            // 收集所有数据
            const data = {
                pin: localStorage.getItem('circleos_pin'),
                wallpaper: localStorage.getItem('circleos_wallpaper'),
                code: localStorage.getItem('circleos_code'),
                notepad: localStorage.getItem('circleos_notepad'),
                tasks: localStorage.getItem('circleos_tasks')
            };

            // 创建JSON字符串
            const dataStr = JSON.stringify(data);

            // 创建下载链接
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'circleos_backup.json';
            link.click();

            // 清理
            URL.revokeObjectURL(url);
        });

        // 设置导入数据按钮
        document.getElementById('import-data').addEventListener('click', function() {
            document.getElementById('import-file').click();
        });

        // 设置文件输入变化事件
        document.getElementById('import-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);

                        // 导入数据
                        if (data.pin) localStorage.setItem('circleos_pin', data.pin);
                        if (data.wallpaper) {
                            localStorage.setItem('circleos_wallpaper', data.wallpaper);
                            applyWallpaper();
                        }
                        if (data.code) localStorage.setItem('circleos_code', data.code);
                        if (data.notepad) localStorage.setItem('circleos_notepad', data.notepad);
                        if (data.tasks) localStorage.setItem('circleos_tasks', data.tasks);

                        alert('数据导入成功');

                        // 重新加载应用内容
                        loadAppData();

                        // 如果计算器应用是打开的，重新加载任务
                        if (document.getElementById('calculator-window').classList.contains('active')) {
                            loadTasks();
                        }
                    } catch (error) {
                        alert('导入失败：无效的数据文件');
                    }
                };
                reader.readAsText(file);
            }
        });
    }

    // 加载应用程序数据
    function loadAppData() {
        // 加载VS Code内容
        const savedCode = localStorage.getItem('circleos_code');
        if (savedCode) {
            document.getElementById('code-editor').value = savedCode;
        }

        // 加载记事本内容
        const savedNote = localStorage.getItem('circleos_notepad');
        if (savedNote) {
            document.getElementById('notepad-content').value = savedNote;
        }

        // 设置保存代码按钮
        document.getElementById('save-code').addEventListener('click', function() {
            const code = document.getElementById('code-editor').value;
            localStorage.setItem('circleos_code', code);
            alert('代码已保存');
        });

        // 设置保存笔记按钮
        document.getElementById('save-note').addEventListener('click', function() {
            const note = document.getElementById('notepad-content').value;
            localStorage.setItem('circleos_notepad', note);
            alert('笔记已保存');
        });

        // 设置任务表单提交
        document.getElementById('task-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const title = document.getElementById('task-title').value;
            const description = document.getElementById('task-description').value;
            const date = document.getElementById('task-date').value;

            // 获取现有任务
            let tasks = JSON.parse(localStorage.getItem('circleos_tasks') || '[]');

            // 添加新任务
            tasks.push({
                id: Date.now(),
                title,
                description,
                date,
                completed: false
            });

            // 保存任务
            localStorage.setItem('circleos_tasks', JSON.stringify(tasks));

            // 清空表单
            document.getElementById('task-form').reset();

            // 重新加载任务列表
            loadTasks();
        });
    }

    // 加载应用内容
    function loadAppContent(appName) {
        if (appName === 'vscode') {
            const savedCode = localStorage.getItem('circleos_code');
            if (savedCode) {
                document.getElementById('code-editor').value = savedCode;
            }
        } else if (appName === 'notepad') {
            const savedNote = localStorage.getItem('circleos_notepad');
            if (savedNote) {
                document.getElementById('notepad-content').value = savedNote;
            }
        }
    }

    // 加载任务
    function loadTasks() {
        const taskList = document.getElementById('task-list');
        taskList.innerHTML = '';

        // 获取任务
        const tasks = JSON.parse(localStorage.getItem('circleos_tasks') || '[]');

        // 按日期排序
        tasks.sort((a, b) => new Date(a.date) - new Date(b.date));

        // 如果没有任务，显示提示
        if (tasks.length === 0) {
            const emptyMessage = document.createElement('li');
            emptyMessage.className = 'text-gray-500 text-center py-4';
            emptyMessage.textContent = '暂无任务，请添加新任务';
            taskList.appendChild(emptyMessage);
            return;
        }

        // 添加任务到列表
        tasks.forEach(task => {
            const taskItem = document.createElement('li');
            taskItem.className = `task-item ${task.completed ? 'completed' : ''}`;

            const taskContent = document.createElement('div');
            taskContent.innerHTML = `
                    <div class="font-medium">${task.title}</div>
                    <div class="text-sm text-gray-600">${task.description}</div>
                    <div class="text-xs text-gray-500">${formatDate(task.date)}</div>
                `;

            const taskActions = document.createElement('div');
            taskActions.className = 'task-actions';

            const completeBtn = document.createElement('button');
            completeBtn.className = 'complete-btn';
            completeBtn.innerHTML = task.completed ?
                '<i class="fa fa-check-circle" aria-hidden="true"></i>' :
                '<i class="fa fa-circle-o" aria-hidden="true"></i>';
            completeBtn.addEventListener('click', () => toggleTaskComplete(task.id));

            const editBtn = document.createElement('button');
            editBtn.className = 'edit-btn';
            editBtn.innerHTML = '<i class="fa fa-pencil" aria-hidden="true"></i>';
            editBtn.addEventListener('click', () => editTask(task.id));

            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.innerHTML = '<i class="fa fa-trash" aria-hidden="true"></i>';
            deleteBtn.addEventListener('click', () => deleteTask(task.id));

            taskActions.appendChild(completeBtn);
            taskActions.appendChild(editBtn);
            taskActions.appendChild(deleteBtn);

            taskItem.appendChild(taskContent);
            taskItem.appendChild(taskActions);

            taskList.appendChild(taskItem);
        });
    }

    // 切换任务完成状态
    function toggleTaskComplete(taskId) {
        const tasks = JSON.parse(localStorage.getItem('circleos_tasks') || '[]');
        const updatedTasks = tasks.map(task => {
            if (task.id === taskId) {
                return { ...task, completed: !task.completed };
            }
            return task;
        });

        localStorage.setItem('circleos_tasks', JSON.stringify(updatedTasks));
        loadTasks();
    }

    // 编辑任务
    function editTask(taskId) {
        const tasks = JSON.parse(localStorage.getItem('circleos_tasks') || '[]');
        const task = tasks.find(t => t.id === taskId);

        if (task) {
            const newTitle = prompt('编辑任务标题:', task.title);
            if (newTitle !== null) {
                const newDescription = prompt('编辑任务描述:', task.description);
                if (newDescription !== null) {
                    const newDate = prompt('编辑任务日期 (YYYY-MM-DD):', task.date);
                    if (newDate !== null) {
                        const updatedTasks = tasks.map(t => {
                            if (t.id === taskId) {
                                return { ...t, title: newTitle, description: newDescription, date: newDate };
                            }
                            return t;
                        });

                        localStorage.setItem('circleos_tasks', JSON.stringify(updatedTasks));
                        loadTasks();
                    }
                }
            }
        }
    }

    // 删除任务
    function deleteTask(taskId) {
        if (confirm('确定要删除这个任务吗？')) {
            const tasks = JSON.parse(localStorage.getItem('circleos_tasks') || '[]');
            const updatedTasks = tasks.filter(task => task.id !== taskId);

            localStorage.setItem('circleos_tasks', JSON.stringify(updatedTasks));
            loadTasks();
        }
    }

    // 格式化日期
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('zh-CN');
    }

    // 设置搜索功能
    function setupSearch() {
        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('search-results');

        searchInput.addEventListener('input', function() {
            const query = this.value.toLowerCase().trim();

            if (query.length === 0) {
                searchResults.classList.remove('active');
                return;
            }

            // 搜索应用程序
            const apps = [
                { name: 'VS Code', icon: 'fa-code', color: 'text-blue-600', app: 'vscode' },
                { name: '记事本', icon: 'fa-file-text-o', color: 'text-green-600', app: 'notepad' },
                { name: '设置', icon: 'fa-cog', color: 'text-gray-600', app: 'settings' },
                { name: '计算器', icon: 'fa-calendar', color: 'text-purple-600', app: 'calculator' }
            ];

            const matchingApps = apps.filter(app => app.name.toLowerCase().includes(query));

            // 搜索任务
            const tasks = JSON.parse(localStorage.getItem('circleos_tasks') || '[]');
            const matchingTasks = tasks.filter(task =>
                task.title.toLowerCase().includes(query) ||
                task.description.toLowerCase().includes(query)
            );

            // 显示搜索结果
            searchResults.innerHTML = '';

            if (matchingApps.length === 0 && matchingTasks.length === 0) {
                const noResults = document.createElement('div');
                noResults.className = 'search-item text-gray-500';
                noResults.textContent = '没有找到匹配的结果';
                searchResults.appendChild(noResults);
            } else {
                // 添加应用程序结果
                matchingApps.forEach(app => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-item flex items-center';
                    resultItem.innerHTML = `
                            <i class="fa ${app.icon} ${app.color} mr-2" aria-hidden="true"></i>
                            <span>${app.name}</span>
                        `;
                    resultItem.addEventListener('click', () => {
                        openApp(app.app);
                        searchResults.classList.remove('active');
                        searchInput.value = '';
                    });
                    searchResults.appendChild(resultItem);
                });

                // 添加任务结果
                matchingTasks.forEach(task => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-item flex items-center';
                    resultItem.innerHTML = `
                            <i class="fa fa-calendar-check-o text-green-600 mr-2" aria-hidden="true"></i>
                            <div>
                                <div>${task.title}</div>
                                <div class="text-xs text-gray-500">${formatDate(task.date)}</div>
                            </div>
                        `;
                    resultItem.addEventListener('click', () => {
                        openApp('calculator');
                        searchResults.classList.remove('active');
                        searchInput.value = '';
                    });
                    searchResults.appendChild(resultItem);
                });
            }

            searchResults.classList.add('active');
        });

        // 点击其他地方关闭搜索结果
        document.addEventListener('click', function(e) {
            if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                searchResults.classList.remove('active');
            }
        });
    }
</script>
</body>
</html>